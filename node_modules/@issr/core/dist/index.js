/*! For license information please see index.js.LICENSE.txt */
/*!
 * banner:
 * @issr/core: 2.2.0
 * Aleksandrov Sergey <gooddev.sergey@gmail.com> (https://github.com/AlexSergey/issr)
 * iSSR the easiest way to move your React application to Server Side Rendering
 * MIT
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("react-dom/server")):"function"==typeof define&&define.amd?define(["react","react-dom/server"],t):"object"==typeof exports?exports.issr=t(require("react"),require("react-dom/server")):e.issr=t(e.react,e["react-dom/server"])}(this,(function(e,t){return(()=>{"use strict";var r=[t=>{t.exports=e},,e=>{e.exports=t}],o={};function i(e){var t=o[e];if(void 0!==t)return t.exports;var n=o[e]={exports:{}};return r[e](n,n.exports,i),n.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{i.r(n),i.d(n,{ExcludeSsr:()=>g,createSsr:()=>y,isBackend:()=>l,isClient:()=>f,serverRender:()=>m,useRegisterEffect:()=>C,useSsrEffect:()=>E,useSsrState:()=>w});var e=i(0);function t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let r;!function(e){e.wait="wait",e.done="done",e.failed="failed"}(r||(r={}));class o{constructor({id:e}){t(this,"id",void 0),t(this,"status",void 0),t(this,"callback",void 0),t(this,"getStatus",(()=>this.status)),t(this,"getCallback",(()=>this.callback)),t(this,"done",(()=>{this.status=r.done})),t(this,"failed",(()=>{this.status=r.failed})),t(this,"getId",(()=>this.id)),this.id=e,this.status=r.wait}addCallback(e){this.status===r.wait&&(this.callback=e)}}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class a{constructor(){s(this,"effects",void 0),s(this,"addEffect",(e=>{this.effects.set(e.getId(),e)})),s(this,"hasEffect",(e=>Boolean(this.effects.get(e)))),s(this,"getEffects",(()=>Array.from(this.effects.values()))),s(this,"getEffect",(e=>this.effects.get(e))),s(this,"getWaited",(()=>this.getEffects().filter((e=>e.getStatus()===r.wait)))),s(this,"runEffects",(async()=>{const e=this.getWaited();if(e.length>0){(await Promise.allSettled(e.map((e=>e.getCallback())))).forEach(((t,r)=>{const o=e[r];"fulfilled"===t.status&&o&&o.done(),"rejected"===t.status&&o&&o.failed()}))}})),this.effects=new Map}}const l=()=>"undefined"==typeof window,f=()=>!l();var c;function u(e,t,r,o){c||(c="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,n=arguments.length-3;if(t||0===n||(t={children:void 0}),1===n)t.children=o;else if(n>1){for(var s=new Array(n),a=0;a<n;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:c,type:e,key:void 0===r?null:""+r,ref:null,props:t,_owner:null}}const d=(0,e.createContext)({}),g=({children:t})=>l()?null:(0,e.isValidElement)(t)?t:"function"==typeof t?t():null,h=({loading:t,onLoad:r})=>((0,e.useEffect)((()=>{!l()&&t&&setTimeout((()=>r(!1)))}),[]),null),y=(e={},t={})=>{const r={calledState:{},loading:!t.onlyClient&&!l(),state:e},o=e=>{r.calledState[e]||(r.calledState[e]=!0)},i=e=>Boolean(r.calledState[e]),n=new a,s=e=>{r.loading=e},f=()=>r.loading,c=()=>{return e=r.state,JSON.parse(JSON.stringify(e));var e},g=({children:t})=>u(d.Provider,{value:{effectCollection:n,getEffectCalledState:i,getState:c,initState:e,isLoading:f,setEffectCalledState:o}},void 0,t,u(h,{loading:r.loading,onLoad:s}));return g.getState=c,g.effectCollection=n,g};var p,S=i(2),v=i.n(S);function b(e,t,r,o){p||(p="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,n=arguments.length-3;if(t||0===n||(t={children:void 0}),1===n)t.children=o;else if(n>1){for(var s=new Array(n),a=0;a<n;a++)s[a]=arguments[a+3];t.children=s}if(t&&i)for(var l in i)void 0===t[l]&&(t[l]=i[l]);else t||(t=i||{});return{$$typeof:p,type:e,key:void 0===r?null:""+r,ref:null,props:t,_owner:null}}const m={stream:async(e,t)=>{if(void 0===v().renderToPipeableStream)throw new Error("Streaming is available only on React 18 or more");const r=y(null==t?void 0:t.cachedState),o=e=>v().renderToPipeableStream(b(r,{},void 0,e),"function"==typeof(null==t?void 0:t.streamOptionsFn)?null==t?void 0:t.streamOptionsFn(r.getState()):null==t?void 0:t.streamOptions),i=async()=>{const n=await e();v().renderToString(b(r,{},void 0,n));const s=r.effectCollection.getWaited();return"function"==typeof(null==t?void 0:t.outsideEffects)&&(await t.outsideEffects(),0===s.length)||0===s.length?o(n):s.length>0?(await r.effectCollection.runEffects(),await i()):o(n)},n=await i();return{state:r.getState(),stream:n}},string:async(e,t)=>{const r=y(null==t?void 0:t.cachedState),o=async()=>{const i=await e(),n=v().renderToString(b(r,{},void 0,i)),s=r.effectCollection.getWaited();return"function"==typeof(null==t?void 0:t.outsideEffects)&&(await t.outsideEffects(),0===s.length)?v().renderToString(b(r,{},void 0,i)):0===s.length?n:s.length>0?(await r.effectCollection.runEffects(),await o()):n};return{html:await o(),state:r.getState()}}},w=(t,r)=>{if("string"!=typeof r)throw new Error('"useSsrState" hook: id is not a string. iSSR required @issr/babel-loader. You can follow official documentation to setup your build system https://github.com/AlexSergey/issr#usage');const{initState:o}=(0,e.useContext)(d),i=(0,e.useMemo)((()=>void 0===o[r]?t:o[r]),[o,r,t]),[n,s]=(0,e.useState)(i),a=(0,e.useCallback)((e=>{const t=e instanceof Function?e(o[r]):e;o[r]=t,s(t)}),[]);return(0,e.useEffect)((()=>()=>{o[r]=void 0,delete o[r]}),[]),[n,a]},E=(t,r,o)=>{const i=Array.isArray(r)?o:"string"==typeof r&&r;if("string"!=typeof i)throw new Error('"useSsrEffect" hook: id is not a string. iSSR required @issr/babel-loader. You can follow official documentation to setup your build system https://github.com/AlexSergey/issr#usage');const n=(0,e.useRef)(!0),s=(0,e.useRef)(t),{isLoading:a,setEffectCalledState:f,getEffectCalledState:c}=(0,e.useContext)(d),u=c(i),g=a(),h=!l()&&g&&n.current,y=l()&&n.current&&!u;n.current=!1;const p=Array.isArray(r)?r:[];(0,e.useEffect)((()=>{s.current=t}),[t]),y&&(t(),f(i)),(0,e.useEffect)((()=>{if(!h&&!y)return"function"==typeof s.current?s.current():void 0}),p.concat([y,h]))},C=t=>{if("string"!=typeof t)throw new Error('"useRegisterEffect" hook: id is not a string. iSSR required @issr/babel-loader. You can follow official documentation to setup your build system https://github.com/AlexSergey/issr#usage');const{effectCollection:r}=(0,e.useContext)(d);return(e,...i)=>{const n=e(...i);if(!r.getEffect(t)){const e=new o({id:t});r.addEffect(e),n instanceof Promise&&e.addCallback(n)}return n}}})(),n})()}));